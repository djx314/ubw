======2020年12月5日更新======{{

======2019年6月16日更新======{{

* [仓库代码地址](https://github.com/xarcher/ubw/tree/master/a20-%E6%9C%88%E7%9B%88%E6%9C%88%E4%BA%8F/src/main/scala/a20)
* [相关 pr-1](https://github.com/xarcher/ubw/pull/3)
* [相关 pr-2](https://github.com/xarcher/ubw/pull/4)

这一次, 我们来实现一个月盈月缺的类型系统模型.
我们可以看看它的效果:

```scala
class 新月
class 上弦
class 渐盈
class 满月

class Init[YY <: HListYuan](yueyuan: YY) extends YQImpl[YY, YueyuanZero](yueyuan, YueyuanZero)

type Yue = Init[YueyuanZero#Add[满月]#Add[渐盈]#Add[上弦]#Add[新月]]
val a1: 新月 = (throw new Exception("ii")): Yue#Current
val a2: 新月 = (throw new Exception("ii")): Yue#Next#Current
val a3: 上弦 = (throw new Exception("ii")): Yue#Next#Next#Current
val a4: 渐盈 = (throw new Exception("ii")): Yue#Next#Next#Next#Current

val a5: 满月 = (throw new Exception("ii")): Yue#Next#Next#Next#Next#Current
val a6: 满月 = (throw new Exception("ii")): Yue#Next#Next#Next#Next#Next#Current
val a7: 渐盈 = (throw new Exception("ii")): Yue#Next#Next#Next#Next#Next#Next#Current

val a8: 上弦 = (throw new Exception("ii")): Yue#Next#Next#Next#Next#Next#Next#Next#Current
val a9: 新月 = (throw new Exception("ii")): Yue#Next#Next#Next#Next#Next#Next#Next#Next#Current

type Yue10 = Yue#Next#Next#Next#Next#Next#Next#Next#Next#Next
val a10: 新月 = (throw new Exception("ii")): Yue10#Current
val a11: 上弦 = (throw new Exception("ii")): Yue10#Next#Current
val a12: 渐盈 = (throw new Exception("ii")): Yue10#Next#Next#Current
val a13: 满月 = (throw new Exception("ii")): Yue10#Next#Next#Next#Current
val a14: 满月 = (throw new Exception("ii")): Yue10#Next#Next#Next#Next#Current
val a15: 渐盈 = (throw new Exception("ii")): Yue10#Next#Next#Next#Next#Next#Current
val a16: 上弦 = (throw new Exception("ii")): Yue10#Next#Next#Next#Next#Next#Next#Current
```

可以看到, 随着一路 Next 代表的时间消逝, 类型系统所呈现的月圆月缺符合我们平时观察的规律:
逐渐满盈, 然后逐渐变为新月, 循环往复, 又像风吹草动, 左摇右摆.
在代码里面, 这个结构表示为两个 HList 互相此消彼长, 可以参看下图:

... 无限延伸 列表1[3] 列表1[2] 列表1[1] 当前元素  列表2[1]  列表2[2] 无限延伸 ...  
触发逆转 无操作   无操作    无操作    无操作   无操作    无操作   触发逆转

当前元素就是在这个链条上不断地前进, 但是一旦到了无限延伸的位置就会触发元素列表逆转的操作,
使得这个前进的操作永远逃不出有意义的元素的范围.
其实说到这里, 大家已经有点察觉了, 嫦娥奔月的重点其实是在西王母或者仙人所赠的两枚仙丹,
这两枚仙丹代表着当前元素左边和右边的那两个掺杂着变换规则的无穷延伸的 HList, 而这无穷延伸的意味则跟长生不老十分相似.
如果两个 HList 合在一起则可以表现月圆月缺这一现象了. 正正对应了嫦娥吃了两枚丹药就飞升到月亮这一传说.
而常年道, "十五的月亮十六圆", 大家会发现, 到了 满月 和 新月 这些临界点, 元素都会重复.
即使一个月还是 30 天, 我们依然可以把 1 天定义为满月, 但现在满月的时间却是 2 天. 为什么呢?
答案就在于设计一个只有一个满月和新月的模型其实是要对满月和新月这两天进行特别处理, 不能一般化,
上述两天满月的设计则较为简洁.

======}}2019年6月16日更新======

* [相关 pr-3](https://github.com/xarcher/ubw/pull/69)
* [相关 pr-4](https://github.com/xarcher/ubw/pull/70)

======}}2020年12月5日更新======
